<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    </script>
    <script src="./resources/library/react.js"></script>
    <script src="./resources/library/react-dom.js"></script>
    <script src="./resources/library/babel.min.js" charset="UTF-8"></script>
    <link rel="stylesheet" href="./resources/css/bootstrap.min.css">
    <link rel="stylesheet" href="./resources/css/app.css">
    <link rel="stylesheet" href="./resources/css/nav.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>

<div class="navbar">
    <img src="./resources/images/logo_1.png" style="max-height:5rem;max-width:9rem;float:right;border:4px solid;">
    <a href="#"><i class="fa fa-fw fa-home"></i> Home</a>
    <a href="#"><i class="fa fa-fw fa-search"></i> Search</a>
    <a href="#"><i class="fa fa-fw fa-envelope"></i> Contact</a>
    <a href="#"><i class="fa fa-fw fa-user"></i> Login</a>
</div>
<div id="commentApp" class="container"></div>
<script type="text/babel">
	/*
		React JS First Application
	*/

		var ParentContainer = React.createClass({

			getInitialState	: function() {
				return {
						comments : [
							'I pledge not to be abusive in my comments!'
						]
				};
			},
			eachComment	: function(text, i) {
				return (
						<CommentComponent key={i} index={i} removeComment={this.removeComment} updateComment={this.updateComment}>
								{text}</CommentComponent>
						);
			},

			removeComment : function(index) {
				console.log('About to remove comment '+(index+1));
				var cmntArr = this.state.comments;
				cmntArr.splice(index,1);
				this.setState({comments : cmntArr});
			},

			updateComment : function(index, newText) {
				console.log('About to update comment '+(index+1));
				var cmntArr = this.state.comments;
				cmntArr[index] = newText;
				this.setState({comments : cmntArr});
			},

			addComment : function(defaultText) {
				var cmntArr = this.state.comments;
				cmntArr.push(defaultText);
				this.setState({comments : cmntArr});
			},

			render	: function() {
				return (
						<div>
						    <NewsContainer />
							<button className="btn btn-primary" onClick={this.addComment.bind(null,'New Comment')}>Add Comment</button>
							{this.state.comments.map(this.eachComment)}
						</div>
						);
			}
		});
		var CommentComponent = React.createClass({

			getInitialState	: function() {
				return {editMode : false};
			},

			render	: function() {

				if(this.state.editMode)
					return this.renderEditMode();
				else
					return this.renderNormalMode();
			},

			renderNormalMode : function() {

				return (
					<div className="hero">
						<p align="center">{this.props.children}</p>
						<button onClick={this.onEditClick} className="btn btn-warning">Edit</button>
						&nbsp;&nbsp;&nbsp;
						<button onClick={this.onRemoveClick} className="btn btn-danger">Remove</button>
						<hr/>
					</div>
				);
			},

			renderEditMode : function() {

				return (
					<div className="hero">
						<textarea ref="newText" defaultValue={this.props.children}></textarea><br/>
						<button onClick={this.onSaveClick} className="btn btn-success">Save</button>
						<hr/>
					</div>
				);
			},

			onEditClick	: function() {
				console.log("Edit button clicked!");
				this.setState({editMode:true});
			},

			onRemoveClick	: function() {
				console.log("Remove button clicked!");
				this.props.removeComment(this.props.index);

			},

			onSaveClick	: function() {
				console.log("Save button clicked!");
				console.log('Entered text is : '+this.refs.newText.value);
				this.setState({editMode:false});
				this.props.updateComment(this.props.index, this.refs.newText.value);
			}
		});

		var NewsContainer = React.createClass({

		    getInitialState : function() {
		       return {newsData: "ABC"};
		    },

		    componentDidMount() {
                fetch("/Adamantium/top-headlines")
                  .then( res => res.json())
                  .then(
                    (data) => {
                      this.setState({
                        newsData: data
                      });
                    },
                    (error) => {
                      console.log(error)
                    }
                  );
            },

		    render: function() {
		        if (this.state.newsData === "ABC")
		            return (<div className="loader"></div>);
		        else
		            return (<div>
		                        <div  >
                                    <span><h3>{this.state.newsData.articles[0].title}</h3> </span>
                                    <br/>
                                    <span><h4>{this.state.newsData.articles[0].content}</h4></span>
                                    <br/>
                                    <img src={this.state.newsData.articles[0].image} width="150" height="120" />
                                    <br/>
                                    <span><a href={this.state.newsData.articles[0].url}> <b>News Source</b></a></span>
                                </div>
                                <div  >
                                    <span><h3>{this.state.newsData.articles[1].title}</h3> </span>
                                    <br/>
                                    <span><h4>{this.state.newsData.articles[1].content}</h4></span>
                                    <br/>
                                    <img src={this.state.newsData.articles[1].image} width="150" height="120" />
                                    <br/>
                                    <span><a href={this.state.newsData.articles[1].url}> <b>News Source</b></a></span>
                                </div>
                                <div  >
                                    <span><h3>{this.state.newsData.articles[2].title}</h3> </span>
                                    <br/>
                                    <span><h4>{this.state.newsData.articles[2].content}</h4></span>
                                    <br/>
                                    <img src={this.state.newsData.articles[2].image} width="150" height="120" />
                                    <br/>
                                    <span><a href={this.state.newsData.articles[2].url}> <b>News Source</b></a></span>
                                </div>
		                        <br/>
		                    </div>);
		    }
		});
		ReactDOM.render(<ParentContainer/>, document.getElementById('commentApp'));

	</script>
</body>
</html>