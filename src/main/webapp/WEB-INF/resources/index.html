<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    </script>
    <script src="./resources/library/react.js"></script>
    <script src="./resources/library/react-dom.js"></script>
    <script src="./resources/library/babel.min.js" charset="UTF-8"></script>
    <link rel="stylesheet" href="./resources/css/bootstrap.min.css">
    <link rel="stylesheet" href="./resources/css/app.css">
    <link rel="stylesheet" href="./resources/css/nav.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>

<div class="navbar">
    <img src="./resources/images/logo4.png" style="max-height:5rem;max-width:9rem;float:right;border:4px solid;">
    <a href="#"><i class="fa fa-fw fa-home"></i> Home</a>
    <a href="#"><i class="fa fa-fw fa-search"></i> Search</a>
    <a href="#"><i class="fa fa-fw fa-envelope"></i> Contact</a>
    <a href="#"><i class="fa fa-fw fa-user"></i> Login</a>
</div>
<div id="commentApp" class="container-fluid"></div>
<script type="text/babel">
	/*
		React JS First Application
	*/

		var ParentContainer = React.createClass({

			getInitialState	: function() {
				return {
						comments : [
							'I pledge not to be abusive in my comments!'
						]
				};
			},
			eachComment	: function(text, i) {
				return (
						<CommentComponent key={i} index={i} removeComment={this.removeComment} updateComment={this.updateComment}>
								{text}</CommentComponent>
						);
			},

			removeComment : function(index) {
				console.log('About to remove comment '+(index+1));
				var cmntArr = this.state.comments;
				cmntArr.splice(index,1);
				this.setState({comments : cmntArr});
			},

			updateComment : function(index, newText) {
				console.log('About to update comment '+(index+1));
				var cmntArr = this.state.comments;
				cmntArr[index] = newText;
				this.setState({comments : cmntArr});
			},

			addComment : function(defaultText) {
				var cmntArr = this.state.comments;
				cmntArr.push(defaultText);
				this.setState({comments : cmntArr});
			},

			render	: function() {
				return (
						<div>
						    <NewsContainer />
						    <hr/>
							<button className="btn btn-primary" onClick={this.addComment.bind(null,'New Comment')}>Add Comment</button>
							{this.state.comments.map(this.eachComment)}
						</div>
						);
			}
		});
		var CommentComponent = React.createClass({

			getInitialState	: function() {
				return {editMode : false};
			},

			render	: function() {

				if(this.state.editMode)
					return this.renderEditMode();
				else
					return this.renderNormalMode();
			},

			renderNormalMode : function() {

				return (
					<div className="hero">
						<p align="center">{this.props.children}</p>
						<button onClick={this.onEditClick} className="btn btn-warning">Edit</button>
						&nbsp;&nbsp;&nbsp;
						<button onClick={this.onRemoveClick} className="btn btn-danger">Remove</button>
						<hr/>
					</div>
				);
			},

			renderEditMode : function() {

				return (
					<div className="hero">
						<textarea ref="newText" defaultValue={this.props.children}></textarea><br/>
						<button onClick={this.onSaveClick} className="btn btn-success">Save</button>
						<hr/>
					</div>
				);
			},

			onEditClick	: function() {
				console.log("Edit button clicked!");
				this.setState({editMode:true});
			},

			onRemoveClick	: function() {
				console.log("Remove button clicked!");
				this.props.removeComment(this.props.index);

			},

			onSaveClick	: function() {
				console.log("Save button clicked!");
				console.log('Entered text is : '+this.refs.newText.value);
				this.setState({editMode:false});
				this.props.updateComment(this.props.index, this.refs.newText.value);
			}
		});

		var NewsContainer = React.createClass({

		    getInitialState : function() {
		       return {newsData: "ABC"};
		    },

		    componentDidMount() {
		        // TODO: Todo item #1
		        /* DEV: fetch("/Adamantium/top-headlines")   */
		        /* PROD: fetch("/top-headlines")   */
		        const params = new URLSearchParams(window.location.search)
                const newsType = params.has('newsTopic') ? params.get('newsTopic') : 'breaking-news';
                fetch("/Adamantium/top-headlines?newsTopic="+newsType)
                  .then( res => res.json())
                  .then(
                    (data) => {
                      this.setState({
                        newsData: data
                      });
                    },
                    (error) => {
                      console.log(error)
                    }
                  );
            },

            eachArticle: function(article) {
                return(
                    <div className="col-sm-4 border border-primary">
                        <span><h5>{article.title}</h5> </span>
                        <br/>
                        <img src={article.image} width="250rem" height="200rem" />
                        <br/>
                        <span><h7>{article.content}</h7></span>
                        <br/>
                        <span><a href={article.url}> <b>News Source</b></a></span>
                    </div>
                );
            },

		    render: function() {
		        if (this.state.newsData === "ABC")
		            return (<div className="loader"></div>);
		        else
		            return (<div className="row">
		                        {this.state.newsData.articles.map(this.eachArticle)}
		                    </div>);
		    }
		});
		ReactDOM.render(<ParentContainer/>, document.getElementById('commentApp'));

	</script>
</body>
</html>